# –°–∞–π—Ç –¥–æ—Å—Ç–∞–≤–∫–∏ –µ–¥—ã Star Burger

–≠—Ç–æ —Å–∞–π—Ç —Å–µ—Ç–∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ Star Burger. –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –∑–∞–∫–∞–∑–∞—Ç—å –ø—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω—ã–µ –±—É—Ä–≥–µ—Ä—ã —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π –Ω–∞ –¥–æ–º.

![—Å–∫—Ä–∏–Ω—à–æ—Ç —Å–∞–π—Ç–∞](https://dvmn.org/filer/canonical/1594651635/686/)

–°–µ—Ç—å Star Burger –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤, –¥–µ–π—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–¥ –µ–¥–∏–Ω–æ–π —Ñ—Ä–∞–Ω—à–∏–∑–æ–π. –£ –≤—Å–µ—Ö —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –º–µ–Ω—é –∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ —Ü–µ–Ω—ã. –ü—Ä–æ—Å—Ç–æ –≤—ã–±–µ—Ä–∏—Ç–µ –±–ª—é–¥–æ –∏–∑ –º–µ–Ω—é –Ω–∞ —Å–∞–π—Ç–µ –∏ —É–∫–∞–∂–∏—Ç–µ –º–µ—Å—Ç–æ –¥–æ—Å—Ç–∞–≤–∫–∏. –ú—ã —Å–∞–º–∏ –Ω–∞–π–¥—ë–º –±–ª–∏–∂–∞–π—à–∏–π –∫ –≤–∞–º —Ä–µ—Å—Ç–æ—Ä–∞–Ω, –≤—Å—ë –ø—Ä–∏–≥–æ—Ç–æ–≤–∏–º –∏ –ø—Ä–∏–≤–µ–∑—ë–º.

–ù–∞ —Å–∞–π—Ç–µ –µ—Å—Ç—å —Ç—Ä–∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞. –ü–µ—Ä–≤—ã–π ‚Äî —ç—Ç–æ –ø—É–±–ª–∏—á–Ω–∞—è —á–∞—Å—Ç—å, –≥–¥–µ –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –±–ª—é–¥–∞ –∏–∑ –º–µ–Ω—é, –∏ –±—ã—Å—Ç—Ä–æ –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑ –±–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏ SMS.

–í—Ç–æ—Ä–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞. –ó–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–∫–∞–∑–æ–≤. –ú–µ–Ω–µ–¥–∂–µ—Ä –≤–∏–¥–∏—Ç –ø–æ—Å—Ç—É–ø–∏–≤—à–∏–µ –Ω–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã –∏ –ø–µ—Ä–≤—ã–º –¥–µ–ª–æ–º —Å–æ–∑–≤–∞–Ω–∏–≤–∞–µ—Ç—Å—è —Å –∫–ª–∏–µ–Ω—Ç–æ–º, —á—Ç–æ–±—ã –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–∫–∞–∑. –ü–æ—Å–ª–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä –≤—ã–±–∏—Ä–∞–µ—Ç –±–ª–∏–∂–∞–π—à–∏–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç —Ç—É–¥–∞ –∑–∞–∫–∞–∑ –Ω–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ. –¢–∞–º –≤—Å—ë –ø—Ä–∏–≥–æ—Ç–æ–≤—è—Ç –∏ —Å–∞–º–∏ –¥–æ—Å—Ç–∞–≤—è—Ç –µ–¥—É –∫–ª–∏–µ–Ω—Ç—É.

–¢—Ä–µ—Ç–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å ‚Äî —ç—Ç–æ –∞–¥–º–∏–Ω–∫–∞. –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ –∏–º –ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—ã –ø—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ —Å–∞–π—Ç–∞. –¢–∞–∫–∂–µ —Å—é–¥–∞ –∑–∞—Ö–æ–¥–∏—Ç –º–µ–Ω–µ–¥–∂–µ—Ä, —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å –º–µ–Ω—é —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ Star Burger.

## –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —Å–∞–π—Ç–∞
–î–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ–∑–¥–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –ë–î –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∞–π—Ç–∞. –†–∞–∑–≤–µ—Ä–Ω–µ–º –µ–π –≤ –¥–æ–∫–µ—Ä–µ
–°–æ–∑–¥–∞–µ–º `docker-compose.yml`
```sh
version: "3.8"
services:
  db:
    container_name: postgres_container
    image: postgres
    restart: always
    environment:
    #–í–∞–∂–Ω–æ –∑–∞–¥–∞—Ç—å –∏–º—è, –ø–∞—Ä–æ–ª—å, –∏–º—è –±–∞–∑—ã - —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –º–æ–∂–Ω–æ –ø–æ—Ç–æ–º –±—É–¥–µ—Ç –±—Ä–∞—Ç—å –∏–∑ —Ñ–∞–π–ª–∞ .env
      POSTGRES_USER: star...user
      POSTGRES_PASSWORD: pas...56
      POSTGRES_DB: st...er
    ports:
    #–¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∏–∑–º–µ–Ω–∏–º –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ä—Ç
      - "5454:5432"
  # –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è —Å–º. https://www.youtube.com/watch?v=qECVC6t_2mU
  pgadmin:
    container_name: pgadmin4_container
    image: dpage/pgadmin4
    restart: always
    environment:
      PGADMIN_DEFAULT_EMAIL: admin@admin.com
      PGADMIN_DEFAULT_PASSWORD: root
    ports:
      - "5050:80"
```

## –í–∞–∂–Ω–æ–µ ! –§–∞–π–ª `.env`
–î–ª—è —Ä–∞–±–æ—Ç—ã —Å–∞–π—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `.env`, –≤–∏–¥–∞

- `DEBUG` ‚Äî –¥–µ–±–∞–≥-—Ä–µ–∂–∏–º. –ü–æ—Å—Ç–∞–≤—å—Ç–µ `False`.
- `SECRET_KEY` ‚Äî —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –ø—Ä–æ–µ–∫—Ç–∞. –û–Ω –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Å–∞–π—Ç–µ. –ù–∞–ø—Ä–∏–º–µ—Ä, –∏–º –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã –≤—Å–µ –ø–∞—Ä–æ–ª–∏ –Ω–∞ –≤–∞—à–µ–º —Å–∞–π—Ç–µ.
- `YANDEX_API_KEY` ‚Äî API –∫–ª—é—á –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è [–≥–µ–æ–∫–æ–¥–µ—Ä–∞](https://developer.tech.yandex.com/services)
- `ROLLBAR_TOKEN_KEY` ‚Äî API –∫–ª—é—á –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –æ—à–∏–±–æ–∫ –≤–∞—à–µ–≥–æ —Å–∞–π—Ç–∞ –ø–æ–¥—Ä–æ–±–Ω–µ–µ –Ω–∞ [Rollbar](https://app.rollbar.com/)
- `ALLOWED_HOSTS` ‚Äî [—Å–º. –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é Django](https://docs.djangoproject.com/en/3.1/ref/settings/#allowed-hosts)
- `DATABASE_URL` = "postgresql://starburger_db_user:—Ç—É—Ç_—É–∫–∞–∑–∞—Ç—å_—Å–≤–æ–π_–ø–∞—Ä–æ–ª—å@localhost/starburger"
–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ —Å–≤–æ–µ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏

```sh
SECRET_KEY=djang...f93n4
YANDEX_API_KEY=0ea7...75f45a1
ROLLBAR_TOKEN_KEY=218a...6e92
ENVIRONMENT="Production"
DATABASE_URL="postgresql://–∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î:–ü–∞—Ä–æ–ª—å@–ê–¥—Ä–µ—Å —Å–∞–π—Ç–∞ –ë–î:–ü–æ—Ä—Ç-5454/–∏–º—è –ë–î"
```

## –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å dev-–≤–µ—Ä—Å–∏—é —Å–∞–π—Ç–∞

–î–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–∞–π—Ç–∞ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É, –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–≤ —Ñ–∞–π–ª
`docker-compose.local-dev.yaml` –≤ `docker-compose.yaml`
```sh
docker-compose -f docker-compose.yaml up -d
```
–°–∞–π—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É http://0.0.0.0:8000

## –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å prod-–≤–µ—Ä—Å–∏—é —Å–∞–π—Ç–∞
–î–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–∞–π—Ç–∞ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É, –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–≤ —Ñ–∞–π–ª
`docker-compose.prod.yaml` –≤ `docker-compose.yaml`
```sh
docker-compose -f docker-compose.yaml up -d
```
–°–∞–π—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ –≤–∞—à–µ–º—É –∞–¥—Ä–µ—Å—É, –∫–æ—Ç–æ—Ä—ã–π –≤—ã —É–∫–∞–∂–∏—Ç–µ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–º —Ñ–∞–π–ª–µ nginx
–í–∞–∂–Ω–æ! –Ω–∞ —Å–∞–π—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–Ω–æ–≥–æ [–∏–º–µ–Ω–∏](https://letsencrypt.org/ru/getting-started/)

## –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ —Ä–∞–±–æ—Ç—ã –¥–æ–∫–µ—Ä–∞
–î–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–∞–π—Ç–∞ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É
```sh
docker-compose logs
```

## –°–∫—Ä–∏–ø—Ç –æ–±–Ω–æ–±–ª–µ–Ω–∏—è
–ù–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ –¥–∞–Ω–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Å–∫—Ä–∏–ø—Ç, —É–ø—Ä–æ—â–∞—é—â–∏–π –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∞–π—Ç–∞
–î–ª—è —Ñ–∞–π–ª–∞ `deploy_star_burger.sh` –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–¥–µ–ª–∞—Ç—å –µ–≥–æ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å
```sh
chmod ugo+x deploy_star_burger.sh
```

–°–µ—Ä–≤–µ—Ä NGINX –±—É–¥–µ—Ç –∑–∞–ø—É—â–µ–Ω –∏ —Å–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ `docker-compose.prod.yaml`
```sh
upstream star_burger {server django-web:8000;}
server {
    listen 80;
    server_name zatomis.ru;
    charset utf8;
    autoindex off;
    location / {
      return 301 https://$host$request_uri;
    }
}
server {
    listen 443 ssl;
    server_name zatomis.ru;
    charset utf8;
    autoindex off;
    add_header Strict-Transport-Security "max-age=31536000";
    ssl_certificate /etc/letsencrypt/live/zatomis.ru/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/zatomis.ru/privkey.pem;
    ssl_ciphers TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-256-GCM-SHA384:ECDHE:!COMPLEMENTOFDEFA>
    ssl_prefer_server_ciphers on;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
    location / {
        proxy_pass http://star_burger;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_redirect off;
        location /media/ {
            alias /webapp/media/;
        }
        location /static/ {
            alias /webapp/static/;
        }
    }
    location /.well-known/acme-challenge/ {
    }
}
```

## –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã
–ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã —Å–∞–π—Ç–∞ –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ [–∞–¥—Ä–µ—Å—É](https://zatomis.ru) üçî.


## –¶–µ–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞
–ö–æ–¥ –Ω–∞–ø–∏—Å–∞–Ω –≤ —É—á–µ–±–Ω—ã—Ö —Ü–µ–ª—è—Ö ‚Äî —ç—Ç–æ —É—Ä–æ–∫ –≤ –∫—É—Ä—Å–µ –ø–æ Python –∏ –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –Ω–∞ —Å–∞–π—Ç–µ [Devman](https://dvmn.org). –ó–∞ –æ—Å–Ω–æ–≤—É –±—ã–ª –≤–∑—è—Ç –∫–æ–¥ –ø—Ä–æ–µ–∫—Ç–∞ [FoodCart](https://github.com/Saibharath79/FoodCart).
